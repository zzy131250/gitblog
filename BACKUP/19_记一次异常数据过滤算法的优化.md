# [记一次异常数据过滤算法的优化](https://github.com/zzy131250/gitblog/issues/19)

> 搬运自老博客，发表时间：2017-07-13

这段时间公司给了个新的需求：对现有的小区均价异常数据过滤算法进行优化，因为现在的过滤算法过滤了大量正常数据，导致均价变化幅度很大，引起客户的怀疑。

# 算法目标
过滤算法的目标是过滤小区房子的错误数据。由于我们的数据来源是中介网站，可以认为错误数据不会很多。另外，如果有错误数据，也认为这是很容易辨识出来的数据。

# 过滤算法V1.0
现有的过滤算法的基本思想是计算幅度。先将小区中房子的成交价按照时间排序，并选取一个月的价格序列，计算相邻价格之间的变化幅度，按照一定的规则确定异常数据。规则如下：
```Python
# 对所有的房子价格求幅度
for n in range(1, len(price_list)-1):
    # 计算前项的幅度
    fn1 = price_list[n] / price_list[n-1] - 1
    # 计算后项的幅度
    fn2 = 1 - price_list[n] / price_list[n+1]
    # 计算平均的幅度
    fn3 = (price_list[n-1] + price_list[n+1]) / 2 / price_list[n]
    # 如果满足下式，则n必为噪点
    if abs(fn1) > a1 and abs(fn2) > b1 and abs(fn3) > c1 and fn1*fn2 < 0:
        noise_index_list.append(n)
        continue
    # 如果满足下式，则n可能为噪点
    if abs(fn1) > a2 and abs(fn2) < b2 and abs(fn3) < c2:
        # 计算n+1的相关指标
        x = n + 1
        if x < len(price_list)-1:
            fx1 = price_list[x] / price_list[x-1] - 1
            fx2 = 1 - price_list[x] / price_list[x+1]
            fx3 = (price_list[x-1] + price_list[x+1]) / 2 / price_list[x]
            # 如果满足下式，则n为噪点
            if abs(fx1) < a2 and abs(fx2) > b2 and abs(fx3) > c2 and fn1*fx2 < 0:
                noise_index_list.append(n)
```